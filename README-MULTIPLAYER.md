# 多玩家模式使用说明

## 概述

游戏现在支持多玩家实时同步模式！多个玩家可以同时连接到同一个游戏，所有玩家的弹幕都会在主游戏界面显示。

## 架构说明

- **主游戏界面** (`index.html`): 显示完整的游戏画面，包括BOSS、所有玩家的弹幕、伤害等
- **玩家端** (`player.html`): 玩家只需上传头像、输入名字和弹幕内容
- **WebSocket服务器** (`server.js`): 负责同步所有玩家的弹幕和游戏状态

## 快速开始

### 1. 安装依赖

首先需要安装Node.js（如果没有安装的话）。

然后安装WebSocket依赖：

```bash
npm install
```

或者手动安装：

```bash
npm install ws
```

### 2. 启动服务器

```bash
node server.js
```

或者：

```bash
npm start
```

服务器将在端口 8080 启动。

### 3. 打开主游戏界面

在浏览器中打开 `index.html`（主游戏界面）

- 可以设置服务器地址（默认为 `ws://localhost:8080`）
- 完成玩家设置后，会自动连接到服务器

### 4. 打开玩家端

在多个浏览器标签页或不同设备上打开 `player.html`（玩家端）

- 上传头像
- 输入玩家名字
- 会自动连接到服务器
- 输入弹幕内容并发送

## 使用场景

### 场景1：单机+多玩家端（推荐）

1. 一台电脑运行服务器并打开主游戏界面
2. 其他玩家在手机/平板上打开玩家端页面
3. 所有玩家的弹幕都会在主游戏界面显示

### 场景2：局域网多玩家

1. 一台电脑运行服务器
2. 主游戏界面和所有玩家端都连接到服务器的IP地址
   - 例如：`ws://192.168.1.100:8080`

### 场景3：跨网络多玩家（需要公网IP或内网穿透）

1. 服务器需要暴露在公网上
2. 所有玩家端连接到公网地址

## 服务器地址配置

### 主游戏界面（index.html）

可以通过URL参数指定服务器地址：

```
index.html?ws=ws://192.168.1.100:8080
```

### 玩家端（player.html）

可以在页面上直接修改服务器地址输入框

## 功能说明

### 主游戏界面

- 显示所有玩家的弹幕（包括自己和其他玩家）
- 显示所有玩家造成的伤害
- 显示BOSS状态
- 可以控制游戏设置和重置

### 玩家端

- 仅用于发送弹幕
- 不显示游戏画面
- 轻量级界面，适合移动设备
- 自动连接到服务器

## 注意事项

1. **服务器必须运行**：多玩家模式需要WebSocket服务器运行
2. **网络延迟**：网络延迟会影响弹幕同步速度
3. **单机模式**：如果服务器未运行，游戏会自动降级到单机模式
4. **端口占用**：确保8080端口未被占用，或在`server.js`中修改端口号

## 故障排除

### 无法连接到服务器

- 检查服务器是否正在运行
- 检查服务器地址是否正确
- 检查防火墙设置
- 如果是跨网络，确保服务器端口已开放

### 弹幕不同步

- 检查网络连接
- 检查浏览器控制台是否有错误
- 确保服务器正在运行

### 端口被占用

修改 `server.js` 中的 `PORT` 变量为其他端口号（如8081、3000等）

## 开发说明

### 修改服务器端口

编辑 `server.js`：

```javascript
const PORT = 8080; // 改为其他端口
```

### 修改默认服务器地址

编辑 `game.js`：

```javascript
const WS_SERVER_URL = 'ws://localhost:8080'; // 改为你的服务器地址
```

## 技术栈

- **前端**: HTML5 Canvas, JavaScript, WebSocket API
- **后端**: Node.js, WebSocket (ws库)
